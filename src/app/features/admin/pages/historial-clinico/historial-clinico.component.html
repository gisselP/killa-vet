<div class="background-gradient"></div>

<div id="historial" class="view-content">
  <div class="container py-5">
    <div class="d-flex justify-content-between align-items-center">
      <div class="d-flex flex-column">
        <h1 class="principal-title">Historial ClÃ­nico</h1>
        <p class="secondary-subtitle fs-6">
          Consulta el historial mÃ©dico completo de las mascotas ğŸ¶ğŸ˜ºğŸ¦œ
        </p>
      </div>
      <button
        class="btn btn-primary btn-cta"
        data-bs-toggle="modal"
        data-bs-target="#modalNuevoRegistro"
      >
        <i class="bi bi-plus-circle me-2"></i>
        Nuevo Registro
      </button>
    </div>
    <div class="row mt-4">
      <div class="col-md-3">
        <div class="glass-card no-lift mb-3">
          <div class="card-body">
            <div class="input-group">
              <span class="input-group-text bg-white border-end-0">ğŸ”</span>
              <input
                type="text"
                class="form-control border-start-0"
                placeholder="Buscar Mascota"
                (input)="onBuscar($event)"
              />
            </div>
            <div class="list-group list-group-flush pt-2">
              @for(mascota of filtradas; track $index){
              <button
                class="list-group-item list-group-item-action"
                (click)="seleccionarMascota(mascota)"
                [class.active]="mascota === mascotaSeleccionada"
              >
                <div class="d-flex align-items-center">
                  <div>
                    <h6 class="mb-0">{{ mascota.nombre }}</h6>
                    <small>{{ mascota.especie }} - {{ mascota.raza }}</small>
                  </div>
                </div>
              </button>
              }
            </div>
          </div>
        </div>
        @if(mascotaSeleccionada){

        <div class="glass-card green">
          <div class="card-body text-center">
            <h5 class="mb-1 text-muted">{{ mascotaSeleccionada.nombre }}</h5>
            <p class="text-muted mb-3">{{ mascotaSeleccionada.especie }}</p>

            <div class="text-start">
              <p class="mb-1">
                <strong>Edad:</strong> {{ mascotaSeleccionada.edad }}
              </p>
              <p class="mb-1">
                <strong>Peso:</strong> {{ mascotaSeleccionada.peso }} kg
              </p>
              <p class="mb-1">
                <strong>DueÃ±o:</strong> {{ mascotaSeleccionada.dueno.nombre }}
              </p>
              <p class="mb-0">
                <strong>TelÃ©fono:</strong
                >{{ mascotaSeleccionada.dueno.telefono }}
              </p>
            </div>
          </div>
        </div>
        }
      </div>

      <div class="col-md-9">
        <div class="glass-card">
          <div class="card-body">
            @for(historial of historialFiltrada; track $index){
            <div class="card mb-3">
              <div class="card-body">
                <div
                  class="d-flex justify-content-between align-items-start mb-3"
                >
                  <div>
                    <h6 class="mb-1">{{ historial.diagnostico }}</h6>
                    <small class="text-muted">
                      ğŸ“… {{ historial.fechaConsulta | date : "dd/MM/yyyy" }} |
                      ğŸ‘¨â€âš•ï¸ Dr. Carlos RodrÃ­guez
                    </small>
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-6 mb-3">
                    <h6 class="text-primary">ğŸ“‹ Tratamiento</h6>
                    <p class="mb-0">
                      {{ historial.tratamiento }}
                    </p>
                  </div>
                  <div class="col-md-6 mb-3">
                    <h6 class="text-primary">ğŸ’Š Medicamentos</h6>
                    <small class="mb-0">
                      {{ historial.medicamentos }}
                    </small>
                  </div>
                  <div class="col-md-6 mb-3">
                    <h6 class="text-primary">âš–ï¸ Peso</h6>
                    <p class="mb-0">{{ historial.peso }} kg</p>
                  </div>
                  <div class="col-md-6 mb-3">
                    <h6 class="text-primary">ğŸŒ¡ï¸ Temperatura</h6>
                    <p class="mb-0">{{ historial.temperatura }}C</p>
                  </div>

                  <div class="col-12">
                    <h6 class="text-primary">ğŸ“ Observaciones</h6>
                    <p class="mb-0">
                      {{ historial.observaciones }}
                    </p>
                  </div>
                </div>
              </div>
            </div>
            } 
          </div>
        </div>
      </div>
    </div>
  </div>
  <div
    class="modal fade"
    id="modalNuevoRegistro"
    tabindex="-1"
    aria-labelledby="modalNuevoRegistroLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title" id="modalNuevoRegistroLabel">
            ğŸ“‹ Nuevo Registro de AtenciÃ³n
          </h5>
          <button
            type="button"
            class="btn-close btn-close-white"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>

        <!-- Body del Modal -->
        <div class="modal-body">
          <form>
            <!-- Info de la mascota (solo lectura) -->
            <div class="alert alert-light border">
              <div class="row">
                <div class="col-md-6">
                  <strong>ğŸ• Mascota:</strong> Max (Golden Retriever)
                </div>
                <div class="col-md-6">
                  <strong>ğŸ‘¤ DueÃ±o:</strong> Juan PÃ©rez
                </div>
              </div>
            </div>

            <!-- Veterinario -->
            <div class="mb-3">
              <label for="veterinario" class="form-label"
                >ğŸ‘¨â€âš•ï¸ Veterinario *</label
              >
              <select class="form-select" id="veterinario" required>
                <option value="">Selecciona un veterinario</option>
                <option value="1">Dra. MarÃ­a GarcÃ­a - Medicina General</option>
                <option value="2">Dr. Carlos RodrÃ­guez - CirugÃ­a</option>
                <option value="3">Dra. Ana LÃ³pez - Emergencias</option>
              </select>
            </div>

            <!-- DiagnÃ³stico -->
            <div class="mb-3">
              <label for="diagnostico" class="form-label"
                >ğŸ©º DiagnÃ³stico *</label
              >
              <input
                type="text"
                class="form-control"
                id="diagnostico"
                required
              />
            </div>

            <!-- Tratamiento -->
            <div class="mb-3">
              <label for="tratamiento" class="form-label"
                >ğŸ“‹ Tratamiento *</label
              >
              <textarea
                class="form-control"
                id="tratamiento"
                rows="2"
                required
              ></textarea>
            </div>

            <!-- Medicamentos -->
            <div class="mb-3">
              <label for="medicamentos" class="form-label"
                >ğŸ’Š Medicamentos</label
              >
              <textarea
                class="form-control"
                id="medicamentos"
                rows="2"
                placeholder="Ej: AntibiÃ³tico (Amoxicilina) 500mg cada 12h por 7 dÃ­as (uno por lÃ­nea)"
              ></textarea>
              <small class="text-muted"
                >Opcional. Escribe cada medicamento en una lÃ­nea nueva.</small
              >
            </div>

            <!-- Peso y Temperatura -->
            <div class="row mb-3">
              <div class="col-md-6">
                <label for="peso" class="form-label">âš–ï¸ Peso (kg) *</label>
                <input
                  type="number"
                  step="0.1"
                  class="form-control"
                  id="peso"
                  required
                />
              </div>
              <div class="col-md-6">
                <label for="temperatura" class="form-label"
                  >ğŸŒ¡ï¸ Temperatura (Â°C)</label
                >
                <input
                  type="number"
                  step="0.1"
                  class="form-control"
                  id="temperatura"
                />
                <small class="text-muted">Opcional</small>
              </div>
            </div>

            <div class="mb-3">
              <label for="observaciones" class="form-label"
                >ğŸ“ Observaciones</label
              >
              <textarea
                class="form-control"
                id="observaciones"
                rows="3"
                placeholder="Cualquier nota adicional sobre la atenciÃ³n..."
              ></textarea>
              <small class="text-muted">Opcional</small>
            </div>
          </form>
        </div>

        <!-- Footer del Modal -->
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Cancelar
          </button>
          <button type="button" class="btn btn-success">
            ğŸ’¾ Guardar Registro
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
